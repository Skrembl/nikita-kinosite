<!doctype html>
<html lang="ru">
    <head>
        <meta charset="UTF-8" />
        <title>Отзывы о фильме</title>
        <link rel="stylesheet" href="styles.css" />
    </head>
    <body>
        <div class="container">
            <header class="site-header">
                <h1 id="movie-title">Загрузка…</h1>
                <p id="movie-desc" class="movie-desc">Описание...</p>
            </header>

            <main>
                <section class="reviews-section">
                    <h2>Отзывы</h2>
                    <ul id="reviews-list" class="reviews-list"></ul>
                </section>

                <section class="form-section">
                    <h2>Оставить отзыв</h2>
                    <form id="review-form" class="review-form">
                        <input
                            type="text"
                            name="name"
                            placeholder="Ваше имя"
                            required
                        />
                        <textarea
                            name="text"
                            placeholder="Ваш отзыв"
                            required
                        ></textarea>
                        <button type="submit">Отправить</button>
                    </form>
                </section>
            </main>
        </div>

        <script>
            const params = new URLSearchParams(window.location.search);
            const filmId = params.get("film_id");

            const movieData = {
                1: {
                    title: "Урок",
                    desc: "Lorem ipsum dolor sit amet consectetur, adipisicing elit. Adipisci, quibusdam! Rem ab numquam magni exercitationem incidunt quia molestias tempore nihil, fuga sed fugit quasi quos animi quis excepturi labore consequatur. Perspiciatis totam veniam eveniet minus voluptatibus laboriosam rerum laborum assumenda sequi pariatur voluptas eum similique velit illo consectetur cupiditate ipsam quae, a quo error soluta doloremque dignissimos animi explicabo. Fugiat? Deleniti, sed. Maiores asperiores sit explicabo alias, consectetur sint dicta veritatis eius iure porro fugiat enim minima recusandae eos quaerat. Ut dolorem tempora minima perferendis, veritatis mollitia est unde necessitatibus.",
                },
                2: {
                    title: "Отряд светлячков",
                    desc: "Lorem ipsum dolor sit amet consectetur, adipisicing elit. Adipisci, quibusdam! Rem ab numquam magni exercitationem incidunt quia molestias tempore nihil, fuga sed fugit quasi quos animi quis excepturi labore consequatur. Perspiciatis totam veniam eveniet minus voluptatibus laboriosam rerum laborum assumenda sequi pariatur voluptas eum similique velit illo consectetur cupiditate ipsam quae, a quo error soluta doloremque dignissimos animi explicabo. Fugiat? Deleniti, sed. Maiores asperiores sit explicabo alias, consectetur sint dicta veritatis eius iure porro fugiat enim minima recusandae eos quaerat. Ut dolorem tempora minima perferendis, veritatis mollitia est unde necessitatibus.",
                },
                3: {
                    title: "В потерянных землях",
                    desc: "Lorem ipsum dolor sit amet consectetur, adipisicing elit. Adipisci, quibusdam! Rem ab numquam magni exercitationem incidunt quia molestias tempore nihil, fuga sed fugit quasi quos animi quis excepturi labore consequatur. Perspiciatis totam veniam eveniet minus voluptatibus laboriosam rerum laborum assumenda sequi pariatur voluptas eum similique velit illo consectetur cupiditate ipsam quae, a quo error soluta doloremque dignissimos animi explicabo. Fugiat? Deleniti, sed. Maiores asperiores sit explicabo alias, consectetur sint dicta veritatis eius iure porro fugiat enim minima recusandae eos quaerat. Ut dolorem tempora minima perferendis, veritatis mollitia est unde necessitatibus.",
                },
                4: {
                    title: "Горная невеста",
                    desc: "Lorem ipsum dolor sit amet consectetur, adipisicing elit. Adipisci, quibusdam! Rem ab numquam magni exercitationem incidunt quia molestias tempore nihil, fuga sed fugit quasi quos animi quis excepturi labore consequatur. Perspiciatis totam veniam eveniet minus voluptatibus laboriosam rerum laborum assumenda sequi pariatur voluptas eum similique velit illo consectetur cupiditate ipsam quae, a quo error soluta doloremque dignissimos animi explicabo. Fugiat? Deleniti, sed. Maiores asperiores sit explicabo alias, consectetur sint dicta veritatis eius iure porro fugiat enim minima recusandae eos quaerat. Ut dolorem tempora minima perferendis, veritatis mollitia est unde necessitatibus.",
                },
                5: {
                    title: "Конклав",
                    desc: "Lorem ipsum dolor sit amet consectetur, adipisicing elit. Adipisci, quibusdam! Rem ab numquam magni exercitationem incidunt quia molestias tempore nihil, fuga sed fugit quasi quos animi quis excepturi labore consequatur. Perspiciatis totam veniam eveniet minus voluptatibus laboriosam rerum laborum assumenda sequi pariatur voluptas eum similique velit illo consectetur cupiditate ipsam quae, a quo error soluta doloremque dignissimos animi explicabo. Fugiat? Deleniti, sed. Maiores asperiores sit explicabo alias, consectetur sint dicta veritatis eius iure porro fugiat enim minima recusandae eos quaerat. Ut dolorem tempora minima perferendis, veritatis mollitia est unde necessitatibus.",
                },
            };
            document.getElementById("movie-title").textContent =
                movieData[filmId].title;
            document.getElementById("movie-desc").textContent =
                movieData[filmId].desc;

            const reviewsList = document.getElementById("reviews-list");
            function loadReviews() {
                fetch(`api/get_reviews.php?film_id=${filmId}`)
                    .then((res) => res.json())
                    .then((data) => {
                        reviewsList.innerHTML = "";
                        if (!data.reviews || data.reviews.length === 0) {
                            reviewsList.innerHTML = "<li>Пока нет отзывов</li>";
                            return;
                        }
                        data.reviews.forEach((r) => {
                            const li = document.createElement("li");
                            li.innerHTML = `<strong>${r.name}</strong> (${r.date}):<br>${r.text}`;
                            reviewsList.appendChild(li);
                        });
                    })
                    .catch((err) => console.error("Ошибка загрузки:", err));
            }
            loadReviews();

            document
                .getElementById("review-form")
                .addEventListener("submit", (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    formData.append("film_id", filmId);
                    fetch("api/add_review.php", {
                        method: "POST",
                        body: formData,
                    })
                        .then((res) => res.json())
                        .then((resp) => {
                            if (resp.success) {
                                loadReviews();
                                e.target.reset();
                            } else {
                                alert("Ошибка: " + resp.error);
                            }
                        })
                        .catch((err) => console.error("Ошибка отправки:", err));
                });
        </script>
    </body>
</html>
